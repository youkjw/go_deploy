import{d as N,k as C,J as h,l as S,m as T,o as c,c as U,b as s,w as r,e,C as f,N as B,i as g,t as y,f as v,a as P,g as D,aW as I,Q as V}from"./index.85d3582f.js";import{X as A}from"./PageHeader.556c52c2.js";import{i as m}from"./image.5d9500d2.js";import{n as X}from"./node.67b41fa8.js";import{u as j}from"./data-table.6c22a710.js";import{r as E,c as F,f as k,d as H}from"./render.edbb01fe.js";import{C as J}from"./CloseOutline.b801982a.js";import{N as L}from"./Select.60c05ccc.js";import{N as M}from"./DataTable.20b75ea0.js";import"./Anchor.d96a0ee7.js";import"./Tag.04c651c7.js";import"./Time.b1d0572f.js";import"./Popconfirm.ac7ac0d3.js";import"./ArrowDown.224587e2.js";import"./Checkbox.1898d3a6.js";import"./RadioGroup.5ac456f1.js";import"./Radio.10d2e386.js";const le=N({setup(Q){const{t:n}=C(),i=h({node:"",name:""}),l=S([]),z=[{title:n("fields.id"),key:"id",fixed:"left",render:a=>E({name:"image_detail",params:{node:i.node||"-",id:a.id}},a.id.substring(7,19))},{title:n("fields.tags"),key:"tags",render(a){var t;if(a.tags)return F((t=a.tags)==null?void 0:t.map(o=>({text:o,type:"default"})),!0,6)}},{title:n("fields.size"),key:"size",render(a){return k(a.size)}},{title:n("fields.created_at"),key:"created"},{title:n("fields.actions"),key:"actions",render(a,t){return H("error",n("buttons.delete"),()=>_(a.id,t),n("prompts.delete"))}}],{state:p,pagination:b,fetchData:d,changePageSize:w}=j(m.search,i,!1);async function _(a,t){await m.delete(i.node,a,""),p.data.splice(t,1)}async function x(){window.dialog.warning({title:n("dialogs.prune_image.title"),content:n("dialogs.prune_image.body"),positiveText:n("buttons.confirm"),negativeText:n("buttons.cancel"),onPositiveClick:async()=>{var t,o;const a=await m.prune(i.node);window.message.info(n("texts.prune_image_success",{count:(t=a.data)==null?void 0:t.count,size:k((o=a.data)==null?void 0:o.size)})),d()}})}return T(async()=>{var t,o;const a=await X.list(!0);l.value=(t=a.data)==null?void 0:t.map(u=>({label:u.name,value:u.id})),(o=a.data)!=null&&o.length&&(i.node=a.data[0].id),d()}),(a,t)=>(c(),U(V,null,[s(A,null,{action:r(()=>[s(e(f),{secondary:"",size:"small",type:"warning",onClick:x},{icon:r(()=>[s(e(B),null,{default:r(()=>[s(e(J))]),_:1})]),default:r(()=>[g(" "+y(e(n)("buttons.prune")),1)]),_:1})]),_:1}),s(e(v),{class:"page-body",vertical:"",size:12},{default:r(()=>[s(e(v),{size:12},{default:r(()=>[l.value&&l.value.length?(c(),P(e(L),{key:0,filterable:"",size:"small","consistent-menu-width":!1,placeholder:e(n)("objects.node"),value:e(i).node,"onUpdate:value":t[0]||(t[0]=o=>e(i).node=o),options:l.value,style:{width:"200px"}},null,8,["placeholder","value","options"])):D("",!0),s(e(I),{size:"small",value:e(i).name,"onUpdate:value":t[1]||(t[1]=o=>e(i).name=o),placeholder:e(n)("fields.name"),clearable:""},null,8,["value","placeholder"]),s(e(f),{size:"small",type:"primary",onClick:t[2]||(t[2]=()=>e(d)())},{default:r(()=>[g(y(e(n)("buttons.search")),1)]),_:1})]),_:1}),s(e(M),{remote:"","row-key":o=>o.name,size:"small",columns:z,data:e(p).data,pagination:e(b),loading:e(p).loading,"onUpdate:page":e(d),onUpdatePageSize:e(w),"scroll-x":"max-content"},null,8,["row-key","data","pagination","loading","onUpdate:page","onUpdatePageSize"])]),_:1})],64))}});export{le as default};
